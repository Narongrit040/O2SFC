<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>One Stop Service Food Court </title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">

    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
    <script src="https://unpkg.com/jquery/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.js"></script>
    <link rel="stylesheet" href="css/onsen-css-components.css">
    <link rel="stylesheet" href="css/onsen-css-components.min.css">
</head>

<body>
    <ons-page>
        <ons-toolbar>
            <div class="center">O2SFC</div>
            <div class="right" id="checkLogingSec2" style="display: none; color:white;">
                <ons-toolbar-button style=" color:red;" onclick="logOut()">LOGOUT</ons-toolbar-button>
            </div>
        </ons-toolbar>

        <ons-tabbar swipeable position="auto">
            <ons-tab page="tab1.html" label="Tab 1" icon="ion-home, material:md-home" badge="7" active>
            </ons-tab>
            <ons-tab page="tab2.html" label="Tab 2" icon="md-settings" active-icon="md-face">
            </ons-tab>
        </ons-tabbar>
    </ons-page>

    <template id="tab1.html">
        <ons-page id="Tab1">
            <div id="checkLogingSec1" style="text-align: center;">
                <ons-button onclick="myAdmin()">Admin</ons-button>
                <ons-button onclick="myQueue() ">Queue</ons-button>
                <ons-button onclick="myTable()">Table</ons-button>
                <br> <br>

                <p>
                    <ons-input id="email" type="email" modifier="underbar" placeholder="Username" value="adminrestvx@gmail.com"
                        float></ons-input>
                </p>
                <p>
                    <ons-input id="password" modifier="underbar" type="password" placeholder="Password" value="123456789"
                        float></ons-input>
                </p>
                <ons-button onclick="logIn()">LOGIN</ons-button>
            </div>
            <div id="inFormatonBlog" style="display: none;">
                <p style="text-align: center; color:white;">
                    <h1>information</h1>

                </p>
                <p id="showFname"></p>
            </div>
        </ons-page>
    </template>

    <template id="tab2.html">
        <ons-page id="Tab2">
            <p style="text-align: center;">

            </p>
        </ons-page>
    </template>


</body>


<script src="js/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.1/firebase.js"></script>

<script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-messaging.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-functions.js"></script>
<script>
    // Initialize Firebase

    var config = {
        apiKey: "AIzaSyAQ4b9LNA2uW6SphMC0qn8qQge9ygn7gVk",
        authDomain: "reststepvx.firebaseapp.com",
        databaseURL: "https://reststepvx.firebaseio.com",
        projectId: "reststepvx",
        storageBucket: "reststepvx.appspot.com",
        messagingSenderId: "562656255607"
    };



    firebase.initializeApp(config);
    var uid;
    firebase.auth().onAuthStateChanged(function (user) {
        if (user) {
            // User is signed in.
            var displayName = user.displayName;
            var email = user.email;
            var emailVerified = user.emailVerified;
            var photoURL = user.photoURL;
            var isAnonymous = user.isAnonymous;
            var uid = user.uid;
            var providerData = user.providerData;
            //  window.location.href = "page2.html";

            $("#checkLogingSec1").hide();
            $("#checkLogingSec2").show();
            $("#inFormatonBlog").show();
            alert(uid);
            checkIdUser(uid);



            // ...
        } else {
            $("#checkLogingSec1").show();
            $("#checkLogingSec2").hide();
            $("#inFormatonBlog").hide();
            // User is signed out.
            uid = null;
            console.log("no");
            console.log(uid);
            //window.location.href = "index.html";
            // ...
        }
    });

    // if(uid != null){

    // }
    function myAdmin() {
        document.getElementById("email").value = "adminrestvx@gmail.com";

    }
    function myQueue() {
        document.getElementById("email").value = "userqueue@gmail.com";

    }
    function myTable() {
        document.getElementById("email").value = "usertable1@gmail.com";

    }
    //----------------------

    function checkIdUser(uid) {
        var mainId;
        $.ajax({

            //CP1. Complete Ajax Code to GET ALL pin data 
            type: "GET",
            url: "https://reststepvx20180923124000.azurewebsites.net/Api/Staffs",

        }).then(function (data) {

            // document.getElementById("firstQueue").innerHTML = data.Name;
            for (var i = 0; i < data.length; i++) {
                if (data[i].Uid === uid) {
                    mainId = data[i].Id;
                }
            }

            console.log(mainId);
            
            checkPosition(mainId);
            checkUid(mainId);

        });
    }
    function checkUid(mainId) {

        $.ajax({

            //CP1. Complete Ajax Code to GET ALL pin data 
            type: "GET",
            url: "https://reststepvx20180923124000.azurewebsites.net/Api/Staffs/" + mainId,

        }).then(function (data) {

            document.getElementById("showFname").innerHTML = data.FirstName;

        });
    }

    function checkPosition(mainId) {
        $.ajax({

            //CP1. Complete Ajax Code to GET ALL pin data 
            type: "GET",
            url: "https://reststepvx20180923124000.azurewebsites.net/Api/Staffs/" + mainId,

        }).then(function (data) {

            // document.getElementById("firstQueue").innerHTML = data.Name;
            
                if (data.Position === "Admin") {
                    console.log("I'm Admin");
                } else if(data.Position === "Queue"){
                    console.log("I'm Queue");
                } else if(data.Position === "Table"){
                    console.log("I'm Table");
                }else if(data.Position == "Chef"){
                    console.log("I'm Chef");
                }else {
                    console.log("Don't have position");
                }
            


        });

    }

</script>



</html>